{% extends 'admin/base_site.html' %}
{% load static %}
{% block extrahead %}
  {{ block.super }}
  <meta charset="ISO-8859-1" />
  <style scoped>
    .receipt {
      padding-right: 20px;
    }
  </style>
{% endblock %}

{% block content %}
  <!-- Custom Tabs -->
  <div class="card w-100">
    <div class="card-header d-flex p-0">
      <h3 class="card-title p-3"><i class="fas fa-file"></i> Relat贸rios</h3>
      <ul class="nav nav-pills ml-auto p-2">
        <li class="nav-item">
          <a class="nav-link active" href="#tab_1" data-toggle="tab">Relat贸rio Individual</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#tab_2" data-toggle="tab">Relat贸rio Geral</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#tab_3" data-toggle="tab">Relat贸rio Por Doador</a>
        </li>
      </ul>
    </div>
    <!-- /.card-header -->
    <div class="card-body">
      <div class="tab-content">
        <div class="tab-pane active" id="tab_1">
          <div class="row">
            <div class="col-md-3">
              <form method="get" action="#tab_1" class="filter-column">
                <input type="hidden" name="report_type" value="individual" />
                {% if individual_form.non_field_errors %}
                  <div class="error help-block text-red">{{ individual_form.non_field_errors }}</div>
                {% endif %}

                {% for field in individual_form %}
                  <div class="mb-3">
                    <label class="form-label">{{ field.label }}</label>
                    {{ field }}

                    <div class="help-block text-red">
                      <ul class="errorlist">
                        {% for error in field.errors %}
                          <li>{{ error }}</li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                {% endfor %}
                <div class="mb-3">
                  <button class="btn btn-primary w-100" type="submit">Gerar</button>
                </div>
              </form>

              {% if receipt_individual %}
                <div class="p-2">
                  <button class="btn btn-outline-success mt-3 w-100" onclick="abrirParaImprimir('')">Imprimir</button>
                </div>
              {% endif %}
            </div>

            <div class="col-md-9 d-flex justify-content-center">
              <div class="receipt" id="receipt_individual" style="max-height: 60vh; overflow-y: auto;">{{ receipt_individual|safe }}</div>
            </div>
          </div>
        </div>
        <!-- /.tab-pane -->
        <div class="tab-pane" id="tab_2">
          <div class="row">
            <div class="col-md-3">
              <form method="get" action="#tab_2" class="filter-column">
                <input type="hidden" name="report_type" value="general" />

                {% if general_form.non_field_errors %}
                  <div class="error help-block text-red">{{ general_form.non_field_errors }}</div>
                {% endif %}

                {% for field in general_form %}
                  <div class="mb-3">
                    <label class="form-label">{{ field.label }}</label>
                    {{ field }}

                    <div class="help-block text-red">
                      <ul class="errorlist">
                        {% for error in field.errors %}
                          <li>{{ error }}</li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                {% endfor %}
                <div class="mb-3">
                  <button class="btn btn-primary w-100" type="submit">Gerar</button>
                </div>
              </form>

              {% if receipt_general %}
                <div class="p-2">
                  <button class="btn btn-outline-success mt-3 w-100" onclick="abrirParaImprimir('')">Imprimir</button>
                </div>
              {% endif %}
            </div>

            <div class="col-md-9 d-flex justify-content-center">
              <div class="receipt" id="receipt_general" style="max-height: 60vh; overflow-y: auto;">{{ receipt_general|safe }}</div>
            </div>
          </div>
        </div>
        <!-- /.tab-pane -->
        <div class="tab-pane" id="tab_3">
          <div class="row">
            <div class="col-md-3">
              <form method="get" action="#tab_3" class="filter-column">
                <input type="hidden" name="report_type" value="donor" />

                {% if donor_form.non_field_errors %}
                  <div class="error help-block text-red">{{ donor_form.non_field_errors }}</div>
                {% endif %}

                {% for field in donor_form %}
                  <div class="mb-3">
                    <label class="form-label">{{ field.label }}</label>
                    {{ field }}

                    <div class="help-block text-red">
                      <ul class="errorlist">
                        {% for error in field.errors %}
                          <li>{{ error }}</li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                {% endfor %}
                <div class="mb-3">
                  <button class="btn btn-primary w-100" type="submit">Gerar</button>
                </div>
              </form>

              {% if receipt_donor %}
                <div class="p-2">
                  <button class="btn btn-outline-success mt-3 w-100" onclick="abrirParaImprimir('')">Imprimir</button>
                </div>
              {% endif %}
            </div>

            <div class="col-md-9 d-flex justify-content-center">
              <div class="receipt" id="receipt_donor" style="max-height: 60vh; overflow-y: auto;">{{ receipt_donor|safe }}</div>
            </div>
          </div>
        </div>
        <!-- /.tab-pane -->
      </div>
      <!-- /.tab-content -->
    </div>
    <!-- /.card-body -->
  </div>
  <!-- ./card -->
{% endblock %}
{% block extrajs %}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const hash = window.location.hash
      if (hash) {
        const triggerEl = document.querySelector(`a[href="${hash}"]`)
        if (triggerEl) {
          new bootstrap.Tab(triggerEl).show()
        }
      }
    
      $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        var target = $(e.target).attr('href')
        history.replaceState(null, null, target)
      })
    })
    
    function abrirParaImprimir(id) {
      window.print()
    }
  </script>

  <style scoped>
    .form-label {
      display: block;
      margin-bottom: 0.25rem;
      font-weight: 500;
    }
  </style>
{% endblock %}
